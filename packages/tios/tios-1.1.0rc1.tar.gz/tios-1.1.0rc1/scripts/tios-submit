#!/usr/bin/env python

import sys
import signal
from tios import producer
from tios._version import __version__
import argparse

parser = argparse.ArgumentParser(description='Submit an MD simulation to *tios*', usage='tios-submit [-h] [--title TITLE] [--selection SELECTION] [--trate TRATE] job_string')
parser.add_argument('-t', '--title', 
                    help='descriptive title for the simulation')
parser.add_argument('-s', '--splitpoint', default=None,
                    help='split point between interesting and less interesting atoms')
parser.add_argument('-r', '--trate', type=float, default=1.0,
                    help='interval (in ps) between frames')
parser.add_argument('-V', '--version', action='version', version=__version__)
indx = 0
for i in range(1, len(sys.argv)):
    if i%2 == 1 and sys.argv[i][0] != '-':
        indx = i
        break

if len(sys.argv) == 2:
    args = parser.parse_args()
else:
    args = parser.parse_args(sys.argv[1:indx])

command = ' '.join(sys.argv[indx:])
tp = producer.from_command(command, title=args.title,
                           trate=args.trate, splitpoint=args.splitpoint,
                           protocol='Mongo')
print('Tios job {} registered.'.format(tp.id))
