<html>
    <head>
        <link rel="stylesheet" type="text/css" href="qrc:///share/static/css/ipfs-ui.css"/>
        <script src="qrc:///qtwebchannel/qwebchannel.js"></script>

        <style>
            body {
                font: 11pt "Montserrat";
            }

            .grayscale { 
                -webkit-filter: grayscale(100%);
                -moz-filter: grayscale(100%);
                -ms-filter: grayscale(100%);
                -o-filter: grayscale(100%);
                filter: grayscale(100%);
                filter: gray;
              }
            .grayout {
                opacity: 0.6; /* Real browsers */
                filter: alpha(opacity = 60); /* MSIE */
            }

            ul {
                list-style-type: none;
                margin: 0;
                padding: 0;
                overflow: hidden;
            }

            .textpreview {
                margin-left: 10px;
                margin-top: 10px;
                background-color: #66d9ff;
                border: 1px solid black;
                padding: 5px;
                display: none;
            }

            .hitdescr {
                margin-left: 10px;
            }

            .hit {
                -webkit-box-shadow: 0 8px 6px -6px black;
                -moz-box-shadow: 0 8px 6px -6px black;
                box-shadow: 0 8px 6px -6px black;
                background-color: #e0e0d1;
                padding: 8px;
                margin: 8px;
                border-radius: 4px;
            }

            .unavailable {
                -webkit-box-shadow: 0 8px 6px -6px black;
                -moz-box-shadow: 0 8px 6px -6px black;
                box-shadow: 0 8px 6px -6px black;
                opacity: 0.6; /* Real browsers */
                filter: alpha(opacity = 60); /* MSIE */
                text-align: right;
            }
            pre {
                white-space: pre-wrap;
                white-space: -moz-pre-wrap;
                white-space: -pre-wrap;
                white-space: -o-pre-wrap;
                word-wrap: break-word;
            }
        </style>

        <script type="text/javascript">
            function previewFile(hash) {
                preview = document.getElementById(hash + "_preview")
                raw = document.getElementById(hash + "_text")
                fetched = document.getElementById(hash + "_fetched")

                if (!fetched) {
                    window.ipfs.cat(hash, function (err, file) {
                        if (!raw || err) {
                            raw.innerHTML = 'IPFS fetch error'
                            throw err
                        } else {
                            document.createElement("p", hash + "_fetched")
                            raw.innerHTML = ''
                            try {
                                var tNode = document.createTextNode(file.toString('utf8'))
                                raw.appendChild(tNode)
                            } catch(err) {
                                raw.innerHTML = 'Decoding error'
                                throw err
                            }
                        }
                    })
                }

                if (preview.style.display === 'none' || !(preview.style.display)) {
                    preview.style.display = 'block'
                } else {
                    preview.style.display = 'none'
                }
            }

            new QWebChannel(qt.webChannelTransport, function (channel) {
                window.galacteek = channel.objects.galacteek;
                window.ipfssearch = channel.objects.ipfssearch;

                channel.objects.ipfssearch.filtersChanged.connect(function() {
                    channel.objects.ipfssearch.search()
                })

                channel.objects.ipfssearch.resultsReadyDom.connect(function(results) {
                    var resDiv = document.getElementById('results')
                    resDiv.innerHTML = results
                });

                window.ipfssearch.objectStatAvailable.connect(function(cid, stat) {
                    var element = document.getElementById(cid)
                });

                window.ipfssearch.objectStatUnavailable.connect(function(cid) {
                    var element = document.getElementById(cid)

                    if (element) {
                        element.setAttribute("class", "unavailable")
                        var fields = element.getElementsByTagName('*')
                        for(var i = 0; i < fields.length; i++) {
                            fields[i].disabled = true
                        }
                    }
                })

                window.ipfssearch.search()
            })

            window.openIpfs = function (path) {
                window.ipfssearch.openLink(path);
            }

            window.hashmark = function (path) {
                window.ipfssearch.hashmark(path);
            }

            window.exploreIpfs = function (path) {
                window.ipfssearch.explore(path);
            }
        </script>


    </head>
    <body>
        <div id="results">
        </div>

        <br/>

        <div align="right">
            <p>
                <img src="qrc:///share/icons/ipfs-search.png"></img>
                Powered by the <a title='ipfs-search.com' href="https://ipfs-search.com"><b>ipfs-search.com</b></a> search engine
            </p>
        </div>
    </body>
</html>
