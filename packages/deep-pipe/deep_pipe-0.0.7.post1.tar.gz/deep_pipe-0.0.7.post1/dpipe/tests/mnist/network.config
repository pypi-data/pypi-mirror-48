from dpipe_configs.model.torch_model import *

from torch.nn import functional
import torch
from torch import nn

from dpipe import layers

cuda = torch.cuda.is_available()

kernel_size = 3
structure = [32, 32, 64, 64]
n_features = 10

model_core = nn.Sequential(
    nn.Conv2d(1, structure[0], kernel_size),
    nn.ReLU(),
    layers.make_consistent_seq(layers.ResBlock2d, structure, kernel_size=kernel_size),
    layers.PyramidPooling(functional.max_pool2d),
    nn.Linear(structure[-1], 16),
    nn.ReLU(),
    nn.Linear(16, n_features)
)

logits2loss = nn.CrossEntropyLoss()
logits2pred = nn.Softmax(-1)
optimize = torch.optim.Adam
