from noughts_and_crosses import recorder


class TestEpisodeRecorder(object):

    def test_snapshot_game(self):
        placement_errors = [
            [-1, 3, 0, 1, 0, -1, -1, 1, 1, 1, -1],
            [-1, 3, 0, 1, 0, -1, -1, 1, 1, 1, -1],
            [1, 1, 0, 1, -1, -1, -1, 1, 1, 1, -1],
            [1, 1, 0, 1, -1, -1, -1, 1, 1, 1, -1]
        ]
        correct_placements = [
            [1, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [-1, 3, 0, 0, 0, 0, 0, 0, 1, 0, 0],
            [1, 7, 0, 0, 0, -1, 0, 0, 1, 0, 0],
            [-1, 8, 0, 0, 0, -1, 0, 0, 1, 1, 0],
            [1, 1, 0, 0, 0, -1, 0, 0, 1, 1, -1],
            [-1, 4, 0, 1, 0, -1, 0, 0, 1, 1, -1],
            [1, 5, 0, 1, 0, -1, -1, 0, 1, 1, -1],
            [-1, 2, 0, 1, 0, -1, -1, 1, 1, 1, -1],
            [1, 0, 0, 1, -1, -1, -1, 1, 1, 1, -1]
        ]
        game_recorder = recorder.GameRecorder(
            placement_errors, correct_placements, 1)

        episode_recorder = recorder.EpisodeRecorder([['foo']], ['bar'])

        episode_recorder.snapshot_game(game_recorder)

        assert episode_recorder.records == [
            ['foo'],
            [-10, -1, 3, 0, 1, 0, -1, -1, 1, 1, 1, -1],
            [-10, -1, 3, 0, 1, 0, -1, -1, 1, 1, 1, -1],
            [-10, 1, 1, 0, 1, -1, -1, -1, 1, 1, 1, -1],
            [-10, 1, 1, 0, 1, -1, -1, -1, 1, 1, 1, -1],
            [2, 1, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            [-2, -1, 3, 0, 0, 0, 0, 0, 0, 1, 0, 0],
            [2, 1, 7, 0, 0, 0, -1, 0, 0, 1, 0, 0],
            [-2, -1, 8, 0, 0, 0, -1, 0, 0, 1, 1, 0],
            [2, 1, 1, 0, 0, 0, -1, 0, 0, 1, 1, -1],
            [-2, -1, 4, 0, 1, 0, -1, 0, 0, 1, 1, -1],
            [2, 1, 5, 0, 1, 0, -1, -1, 0, 1, 1, -1],
            [-2, -1, 2, 0, 1, 0, -1, -1, 1, 1, 1, -1],
            [10, 1, 0, 0, 1, -1, -1, -1, 1, 1, 1, -1]

        ]

        assert episode_recorder.winners == ['bar', 1]


