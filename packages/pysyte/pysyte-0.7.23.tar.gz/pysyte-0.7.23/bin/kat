#! /usr/bin/env python3
"""Show some lines from files"""

import sys

from pysyte import __version__
from pysyte.cli import streams
from pysyte.cli.main import run
from pysyte.types import lines


def parse_args(parser):
    """Parse out command line arguments"""
    p = parser
    p.positionals('files', help='files to edit')
    p.string('-a', '--at', default="", help='Show line at the line number')
    p.string('-f', '--first', default="1",
               help='number/regexp of first line to show')
    p.string('-l', '--last', default="0",
               help='number/regexp of last line to show')
    p.boolean('-p', '--paste', help='Paste text from clipboard')
    p.boolean('-i', '--stdin', help='Wait for text from stdin')
    p.boolean('-n', '--numbers', help='Show line numbers')
    p.int('-w', '--width', help='Max width of shown line')
    p.boolean('-v', '--version', help='Show version')


def post_parse(args):
    if args.version:
        print(f'{sys.argv[0]} version: {__version__}')
        sys.exit(0)
    return args


def fill_arg(arg):
    at = 0
    if not arg:
        return 0
    try:
        return int(arg)
    except TypeError:
        return arg


def main(args):
    """Run the script"""
    at = fill_arg(args.at)
    first = fill_arg(args.first) or 1
    last = fill_arg(args.last) or -1
    for stream in streams.args(args, 'files'):
        start, lines_in = lines.first_and_rest(
            stream,
            at,
            first,
            last
        )
        lines_out = lines.reformat_lines(
            lines_in, start, args.numbers, args.width)
        print(lines.text(lines_out))
    return True


run(main, parse_args, post_parse)
