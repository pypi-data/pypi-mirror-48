#!/usr/bin/env python
import sys
sys.path.insert(0,'../')

try:
    from Market import Market
    from Business import Business
    from db import local_ip_address,users
except:
    from mural.Market import Market
    from mural.Business import Business
    from mural.db import local_ip_address,users

import argparse
from pymongo import MongoClient
import getpass

parser = argparse.ArgumentParser(description='Admin util')
parser.add_argument('name', metavar='name', type=str, nargs=1, help="The name of a business.")
args=parser.parse_args()

password=getpass.getpass('What is the sound of silence:')
if int(password) == 1123581321:
    name=args.name[0]
    business=Business.load(name)
    data={'name': name, 'ip': local_ip_address, 'business': business._id}
    print(local_ip_address)
    print(users.update_one({'name': data['name']},{'$set': data},upsert=True))

